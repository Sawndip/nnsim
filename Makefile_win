CXX=cl.exe
NUMPY_INC_DIR=C:\Python27\Lib\site-packages\numpy\core\include\numpy
PY_INC_DIR=C:\Python27\include
BDIR=build
PY_LIB_DIR=C:\Python27\libs

all: nnsim_pykernel.pyd

nnsim_pykernel.pyd: $(BDIR) $(BDIR)\kernel_api.obj $(BDIR)\py_neuronet.obj 
	link.exe /DLL $(BDIR)\py_neuronet.obj $(BDIR)\kernel_api.obj $(PY_LIB_DIR)"/python27.lib" /out:"$@"

$(BDIR)\py_neuronet.obj: py_neuronet.cpp kernel_api.h
	$(CXX) -D"FOR_WINDOWS" -EHsc -Ox -c py_neuronet.cpp -I"$(PY_INC_DIR)" -I"$(NUMPY_INC_DIR)" /Fo$@

$(BDIR)\kernel_api.obj: kernel_api.cpp kernel_api.h 
	$(CXX) -EHsc -Ox -c kernel_api.cpp /Fo$@

$(BDIR): 
	mkdir $(BDIR)

clean:
	rmdir /S /Q $(BDIR)
	del nnsim_pykernel.pyd nnsim_pykernel.exp nnsim_pykernel.lib
